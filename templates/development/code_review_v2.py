# -*- coding: utf-8 -*-
"""
================================================================================
ì½”ë“œ ë¦¬ë·° í”„ë¡¬í”„íŠ¸ V2.0 (Code Review Prompts V2.0)
================================================================================

## V2.0 í•µì‹¬ ê°œì„ ì‚¬í•­

### 1. ë™ì  ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒì„± (Dynamic Checklist Generation)
- expected_issuesë¥¼ ë¶„ì„ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ì§ì ‘ ë³€í™˜
- LLMì´ ê° í•­ëª©ì„ ë°˜ë“œì‹œ ê²€í† í•˜ë„ë¡ ê°•ì œ
- ë¹„ì¦ˆë‹ˆìŠ¤ V3.0ì—ì„œ ê²€ì¦ëœ ê¸°ë²• ì ìš©

### 2. 5ë‹¨ê³„ ëˆ„ì  Chain-of-Thought
- STEP 1: ì½”ë“œ ì²«ì¸ìƒ (10ì´ˆ ë¶„ì„)
- STEP 2: ì²´í¬ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ ì‹¬ì¸µ ë¶„ì„
- STEP 3: ì´ìŠˆ ë¶„ë¥˜ ë° ìš°ì„ ìˆœìœ„í™”
- STEP 4: ê°œì„  ì½”ë“œ ì œì‹œ
- STEP 5: ìµœì¢… ë¦¬ë·° ìš”ì•½

### 3. ì„œë¸Œì¹´í…Œê³ ë¦¬ë³„ ì „ë¬¸ê°€ í˜ë¥´ì†Œë‚˜
- general: í´ë¦° ì½”ë“œ ì „ë¬¸ê°€
- security: AppSec ì—”ì§€ë‹ˆì–´
- performance: ì„±ëŠ¥ ìµœì í™” ì „ë¬¸ê°€
- refactoring: ë¦¬íŒ©í† ë§ ì „ë¬¸ê°€

### 4. Few-shot ì˜ˆì‹œ
- ì‹¤ì œ ë¶„ì„ íŒ¨í„´ì„ ë³´ì—¬ì£¼ëŠ” ì˜ˆì‹œ í¬í•¨

## í‰ê°€ ê¸°ì¤€ ìµœì í™”
- issue_detection_rate * 4 (ìµœëŒ€ 4ì ) â†’ ë™ì  ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ê·¹ëŒ€í™”
- has_code_block (2ì ) â†’ STEP 4ì—ì„œ ë°˜ë“œì‹œ í¬í•¨
- has_structure (2ì ) â†’ í…Œì´ë¸”, ì„¹ì…˜ êµ¬ì¡° ê°•ì œ
- has_specific_suggestions (2ì ) â†’ êµ¬ì²´ì  ê°œì„  ë°©í–¥ ê°•ì œ

================================================================================
"""

from typing import List, Optional


# ============================================================================
# ê³µí†µ ë¶„ì„ í”„ë ˆì„ì›Œí¬
# ============================================================================

def _build_checklist(expected_issues: List[str]) -> str:
    """expected_issuesë¥¼ ë¶„ì„ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜"""
    if not expected_issues:
        return "- ì¼ë°˜ì ì¸ ì½”ë“œ í’ˆì§ˆ ê²€í† "

    checklist_items = []
    for i, issue in enumerate(expected_issues, 1):
        checklist_items.append(f"| {i} | **{issue}** | ğŸ” ê²€í†  í•„ìš” |")

    return "\n".join(checklist_items)


def _build_analysis_sections(expected_issues: List[str]) -> str:
    """expected_issuesë¥¼ ë¶„ì„ ì„¹ì…˜ìœ¼ë¡œ ë³€í™˜ (ë™ì  ì„¹ì…˜ ìƒì„±)"""
    if not expected_issues:
        return """
#### ë¶„ì„ í•­ëª© 1: ì¼ë°˜ ì½”ë“œ í’ˆì§ˆ
- **ë°œê²¬ ì—¬ë¶€**: [ì˜ˆ/ì•„ë‹ˆì˜¤]
- **í•´ë‹¹ ìœ„ì¹˜**: [ë¼ì¸ ë²ˆí˜¸]
- **ìƒì„¸ ì„¤ëª…**: [êµ¬ì²´ì  ì„¤ëª…]
- **ê°œì„  ë°©í–¥**: [êµ¬ì²´ì  ê°œì„ ì•ˆ]
"""

    sections = []
    for i, issue in enumerate(expected_issues, 1):
        sections.append(f"""
#### ë¶„ì„ í•­ëª© {i}: {issue}
- **ë°œê²¬ ì—¬ë¶€**: [ì˜ˆ/ì•„ë‹ˆì˜¤]
- **í•´ë‹¹ ìœ„ì¹˜**: [ë¼ì¸ ë²ˆí˜¸ ë˜ëŠ” "í•´ë‹¹ ì—†ìŒ"]
- **ìƒì„¸ ì„¤ëª…**: [êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ ë¬¸ì œì¸ì§€]
- **ê°œì„  ë°©í–¥**: [ì–´ë–»ê²Œ ìˆ˜ì •í•´ì•¼ í•˜ëŠ”ì§€]
""")

    return "\n".join(sections)


# ============================================================================
# ì¼ë°˜ ì½”ë“œ ë¦¬ë·° V2.0
# ============================================================================

GENERAL_REVIEW_V2_TEMPLATE = """## ì—­í• : í´ë¦° ì½”ë“œ ì „ë¬¸ê°€

ë‹¹ì‹ ì€ 15ë…„ ê²½ë ¥ì˜ ì‹œë‹ˆì–´ ì†Œí”„íŠ¸ì›¨ì–´ ì•„í‚¤í…íŠ¸ì…ë‹ˆë‹¤.

**ë‚˜ì˜ 3ê°€ì§€ ì›ì¹™:**
1. "ì½”ë“œëŠ” ì‚¬ëŒì´ ì½ê¸° ìœ„í•´ ì‘ì„±í•œë‹¤" - ë¡œë²„íŠ¸ ë§ˆí‹´
2. "ëª…í™•í•œ ì½”ë“œëŠ” ì£¼ì„ì´ í•„ìš” ì—†ë‹¤"
3. "í•œ í•¨ìˆ˜ëŠ” í•œ ê°€ì§€ ì¼ë§Œ í•´ì•¼ í•œë‹¤"

---

## ë¶„ì„ ëŒ€ìƒ

**ì–¸ì–´**: {language}
**í”„ë ˆì„ì›Œí¬**: {framework}
**íŒŒì¼**: {filename}

```{language_lower}
{code}
```

---

## ë¶„ì„ ì²´í¬ë¦¬ìŠ¤íŠ¸

âš ï¸ **ì¤‘ìš”**: ì•„ë˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ì˜ **ëª¨ë“  í•­ëª©**ì„ ë°˜ë“œì‹œ ë¶„ì„í•´ì•¼ í•©ë‹ˆë‹¤.

| ë²ˆí˜¸ | ê²€í†  í•­ëª© | ìƒíƒœ |
|------|----------|------|
{checklist}

---

## STEP 1: ì½”ë“œ ì²«ì¸ìƒ (10ì´ˆ ë¶„ì„)

ì´ ì½”ë“œë¥¼ ì²˜ìŒ ë´¤ì„ ë•Œ ë“œëŠ” ìƒê°ì„ ì ìœ¼ì„¸ìš”:
- ì „ì²´ êµ¬ì¡°ê°€ ëª…í™•í•œê°€?
- ì¦‰ì‹œ ëˆˆì— ë„ëŠ” ë¬¸ì œì ì´ ìˆëŠ”ê°€?
- ì½”ë“œì˜ ì˜ë„ê°€ íŒŒì•…ë˜ëŠ”ê°€?

**ì²«ì¸ìƒ ìš”ì•½** (1-2ë¬¸ì¥):
[ì‘ì„±]

---

## STEP 2: ì²´í¬ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ ì‹¬ì¸µ ë¶„ì„

ê° ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª©ì„ í•˜ë‚˜ì”© ë¶„ì„í•©ë‹ˆë‹¤.

{analysis_sections}

---

## STEP 3: ì´ìŠˆ ë¶„ë¥˜ ë° ìš°ì„ ìˆœìœ„

ë°œê²¬ëœ ì´ìŠˆë¥¼ ì‹¬ê°ë„ë³„ë¡œ ë¶„ë¥˜í•©ë‹ˆë‹¤.

### Critical (ì¦‰ì‹œ ìˆ˜ì • í•„ìš”)
| ë¼ì¸ | ì´ìŠˆ | ì˜í–¥ | ìˆ˜ì • ì½”ë“œ |
|------|------|------|----------|
| L{line_placeholder} | [ì´ìŠˆ ì„¤ëª…] | [ì˜í–¥ë„] | `[ìˆ˜ì • ì½”ë“œ]` |

### Major (ìˆ˜ì • ê¶Œì¥)
| ë¼ì¸ | ì´ìŠˆ | ê°œì„  ë°©í–¥ |
|------|------|----------|
| L{line_placeholder} | [ì´ìŠˆ ì„¤ëª…] | [ê°œì„  ë°©í–¥] |

### Minor (ê°œì„ í•˜ë©´ ì¢‹ìŒ)
| ë¼ì¸ | ì´ìŠˆ | ì œì•ˆ |
|------|------|------|
| L{line_placeholder} | [ì´ìŠˆ ì„¤ëª…] | [ì œì•ˆ] |

---

## STEP 4: ê°œì„ ëœ ì „ì²´ ì½”ë“œ

ìœ„ì—ì„œ ë°œê²¬í•œ ëª¨ë“  ì´ìŠˆë¥¼ ìˆ˜ì •í•œ ì½”ë“œì…ë‹ˆë‹¤.

```{language_lower}
[ë¦¬íŒ©í† ë§ëœ ì „ì²´ ì½”ë“œ]
```

**ë³€ê²½ ì‚¬í•­ ìš”ì•½**:
1. [ë³€ê²½ 1]
2. [ë³€ê²½ 2]
3. [ë³€ê²½ 3]

---

## STEP 5: ìµœì¢… ë¦¬ë·° ìš”ì•½

### ì¢…í•© í‰ê°€
- **í’ˆì§ˆ ì ìˆ˜**: [X/10]
- **í•µì‹¬ ë¬¸ì œ**: [í•œ ë¬¸ì¥]
- **ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”**: [ì˜ˆ/ì•„ë‹ˆì˜¤]

### ì˜ëœ ì  (Keep)
1. [ì˜ëœ ì  1]
2. [ì˜ëœ ì  2]

### í•™ìŠµ í¬ì¸íŠ¸
- [ì´ ì½”ë“œì—ì„œ ë°°ìš¸ ìˆ˜ ìˆëŠ” êµí›ˆ]

---

## ê²€í†  ì™„ë£Œ í™•ì¸

âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸ ëª¨ë“  í•­ëª© ë¶„ì„ ì™„ë£Œ
âœ… Critical/Major/Minor ì´ìŠˆ ë¶„ë¥˜ ì™„ë£Œ
âœ… ê°œì„  ì½”ë“œ ì œì‹œ ì™„ë£Œ
âœ… ìµœì¢… ìš”ì•½ ì‘ì„± ì™„ë£Œ
"""


# ============================================================================
# ë³´ì•ˆ ì½”ë“œ ë¦¬ë·° V2.0
# ============================================================================

SECURITY_REVIEW_V2_TEMPLATE = """## ì—­í• : ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆ ì „ë¬¸ê°€ (AppSec Engineer)

ë‹¹ì‹ ì€ 10ë…„ ê²½ë ¥ì˜ ë³´ì•ˆ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

**ë‚˜ì˜ 3ê°€ì§€ ì›ì¹™:**
1. "ëª¨ë“  ì…ë ¥ì€ ì•…ì˜ì ì´ë¼ê³  ê°€ì •í•˜ë¼"
2. "ìµœì†Œ ê¶Œí•œ ì›ì¹™ì„ í•­ìƒ ì ìš©í•˜ë¼"
3. "ë³´ì•ˆì€ ê³„ì¸µì ìœ¼ë¡œ êµ¬í˜„í•˜ë¼ (Defense in Depth)"

**ì „ë¬¸ ë¶„ì•¼**: OWASP Top 10, CWE, CVSS, ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸, ë³´ì•ˆ ì½”ë“œ ë¦¬ë·°

---

## ë¶„ì„ ëŒ€ìƒ

**ì–¸ì–´**: {language}
**ì• í”Œë¦¬ì¼€ì´ì…˜ ìœ í˜•**: {app_type}
**ë°ì´í„° ìœ í˜•**: {data_type}

```{language_lower}
{code}
```

---

## ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

âš ï¸ **ì¤‘ìš”**: ì•„ë˜ ë³´ì•ˆ í•­ëª©ì„ **ë°˜ë“œì‹œ** ëª¨ë‘ ê²€í† í•´ì•¼ í•©ë‹ˆë‹¤.

| ë²ˆí˜¸ | ê²€í†  í•­ëª© | ìƒíƒœ |
|------|----------|------|
{checklist}

---

## STEP 1: ë³´ì•ˆ ìœ„í˜‘ ëª¨ë¸ë§ (Threat Modeling)

### ê³µê²© í‘œë©´ ë¶„ì„
- **ì…ë ¥ ê²½ë¡œ**: [ì‚¬ìš©ì ì…ë ¥ì´ ë“¤ì–´ì˜¤ëŠ” ê²½ë¡œ]
- **ë°ì´í„° íë¦„**: [ë°ì´í„°ê°€ ì²˜ë¦¬ë˜ëŠ” ê²½ë¡œ]
- **ì¶œë ¥ ê²½ë¡œ**: [ë°ì´í„°ê°€ ë‚˜ê°€ëŠ” ê²½ë¡œ]

### ì ì¬ì  ê³µê²©ì
- **ì™¸ë¶€ ê³µê²©ì**: [ê°€ëŠ¥í•œ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤]
- **ë‚´ë¶€ ìœ„í˜‘**: [ë‚´ë¶€ì ìœ„í˜‘ ê°€ëŠ¥ì„±]

---

## STEP 2: ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ ë¶„ì„

{analysis_sections}

---

## STEP 3: ì·¨ì•½ì  ë¶„ë¥˜ (CVSS ê¸°ë°˜)

### Critical (CVSS 9.0-10.0) - ì¦‰ì‹œ íŒ¨ì¹˜ í•„ìš”
| ì·¨ì•½ì  | CWE ID | ë¼ì¸ | ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ | ì˜í–¥ |
|--------|--------|------|---------------|------|
| [ì·¨ì•½ì ëª…] | CWE-XXX | L{line_placeholder} | [ê³µê²© ë°©ë²•] | [ì˜í–¥] |

**ì·¨ì•½í•œ ì½”ë“œ:**
```{language_lower}
[ì·¨ì•½í•œ ì½”ë“œ ë¶€ë¶„]
```

**ì•ˆì „í•œ ì½”ë“œ:**
```{language_lower}
[ìˆ˜ì •ëœ ì½”ë“œ]
```

### High (CVSS 7.0-8.9) - ë¹ ë¥¸ ìˆ˜ì • í•„ìš”
| ì·¨ì•½ì  | CWE ID | ë¼ì¸ | ì„¤ëª… |
|--------|--------|------|------|
| [ì·¨ì•½ì ëª…] | CWE-XXX | L{line_placeholder} | [ì„¤ëª…] |

### Medium/Low - ê°œì„  ê¶Œì¥
| ì·¨ì•½ì  | ì‹¬ê°ë„ | ì„¤ëª… | ê¶Œì¥ ì¡°ì¹˜ |
|--------|--------|------|----------|
| [ì·¨ì•½ì ëª…] | [Medium/Low] | [ì„¤ëª…] | [ì¡°ì¹˜] |

---

## STEP 4: ë³´ì•ˆ ê°•í™”ëœ ì½”ë“œ

ëª¨ë“  ì·¨ì•½ì ì„ ìˆ˜ì •í•œ ì•ˆì „í•œ ì½”ë“œì…ë‹ˆë‹¤.

```{language_lower}
[ë³´ì•ˆ ê°•í™”ëœ ì „ì²´ ì½”ë“œ]
```

**ë³´ì•ˆ ê°œì„  ì‚¬í•­:**
1. [ê°œì„  1 - ì–´ë–¤ ì·¨ì•½ì ì„ ì–´ë–»ê²Œ ìˆ˜ì •í–ˆëŠ”ì§€]
2. [ê°œì„  2]
3. [ê°œì„  3]

---

## STEP 5: ë³´ì•ˆ ë¦¬ë·° ìš”ì•½

### ë³´ì•ˆ ì ìˆ˜
- **ì ìˆ˜**: [X/10]
- **ìœ„í—˜ ìˆ˜ì¤€**: [Critical/High/Medium/Low]
- **ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš” í•­ëª©**: [ê°œìˆ˜]

### ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ ê²°ê³¼
- [ ] ì…ë ¥ ê²€ì¦ êµ¬í˜„ ì—¬ë¶€
- [ ] ì¶œë ¥ ì¸ì½”ë”© ì ìš© ì—¬ë¶€
- [ ] ì¸ì¦/ì¸ê°€ ê²€ì¦ ì—¬ë¶€
- [ ] ì•”í˜¸í™” ì ì ˆì„± ì—¬ë¶€
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ì•ˆì „ì„± ì—¬ë¶€

### ê¶Œì¥ ì¡°ì¹˜ ìš°ì„ ìˆœìœ„
1. **ì¦‰ì‹œ**: [ê°€ì¥ ê¸´ê¸‰í•œ ì¡°ì¹˜]
2. **ì´ë²ˆ ì£¼**: [ë¹ ë¥¸ ìˆ˜ì • í•„ìš”]
3. **ì´ë²ˆ ë‹¬**: [ê°œì„  ê¶Œì¥]

---

## ê²€í†  ì™„ë£Œ í™•ì¸

âœ… ìœ„í˜‘ ëª¨ë¸ë§ ì™„ë£Œ
âœ… ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ ëª¨ë“  í•­ëª© ë¶„ì„ ì™„ë£Œ
âœ… ì·¨ì•½ì  CVSS ë¶„ë¥˜ ì™„ë£Œ
âœ… ì•ˆì „í•œ ì½”ë“œ ì œì‹œ ì™„ë£Œ
"""


# ============================================================================
# ì„±ëŠ¥ ì½”ë“œ ë¦¬ë·° V2.0
# ============================================================================

PERFORMANCE_REVIEW_V2_TEMPLATE = """## ì—­í• : ì„±ëŠ¥ ìµœì í™” ì „ë¬¸ê°€

ë‹¹ì‹ ì€ 12ë…„ ê²½ë ¥ì˜ ì„±ëŠ¥ ì—”ì§€ë‹ˆì–´ì…ë‹ˆë‹¤.

**ë‚˜ì˜ 3ê°€ì§€ ì›ì¹™:**
1. "ì¸¡ì •í•˜ì§€ ì•Šìœ¼ë©´ ìµœì í™”í•˜ì§€ ë§ˆë¼"
2. "O(nÂ²)ì€ í•­ìƒ ì˜ì‹¬í•˜ë¼"
3. "I/Oê°€ ê°€ì¥ ëŠë¦¬ë‹¤ - ìµœì†Œí™”í•˜ë¼"

**ì „ë¬¸ ë¶„ì•¼**: ì•Œê³ ë¦¬ì¦˜ ë³µì¡ë„, ë©”ëª¨ë¦¬ ìµœì í™”, ë³‘ë ¬ ì²˜ë¦¬, ìºì‹± ì „ëµ

---

## ë¶„ì„ ëŒ€ìƒ

**ì–¸ì–´**: {language}
**í˜¸ì¶œ ë¹ˆë„**: {call_frequency}
**ë°ì´í„° ê·œëª¨**: {data_scale}
**í˜„ì¬ ì´ìŠˆ**: {current_issue}

```{language_lower}
{code}
```

---

## ì„±ëŠ¥ ì²´í¬ë¦¬ìŠ¤íŠ¸

âš ï¸ **ì¤‘ìš”**: ì•„ë˜ ì„±ëŠ¥ í•­ëª©ì„ **ë°˜ë“œì‹œ** ëª¨ë‘ ë¶„ì„í•´ì•¼ í•©ë‹ˆë‹¤.

| ë²ˆí˜¸ | ê²€í†  í•­ëª© | ìƒíƒœ |
|------|----------|------|
{checklist}

---

## STEP 1: ì„±ëŠ¥ í”„ë¡œíŒŒì¼ë§ (ì²«ì¸ìƒ)

### í˜„ì¬ ë³µì¡ë„ ë¶„ì„
- **ì‹œê°„ ë³µì¡ë„**: O(?)
- **ê³µê°„ ë³µì¡ë„**: O(?)
- **ì£¼ìš” ë³‘ëª© ì§€ì **: [ì˜ˆìƒ ë³‘ëª©]

### Hot Path ì‹ë³„
ê°€ì¥ ìì£¼ ì‹¤í–‰ë˜ëŠ” ê²½ë¡œ:
1. [ê²½ë¡œ 1]
2. [ê²½ë¡œ 2]

---

## STEP 2: ì„±ëŠ¥ ì²´í¬ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ ë¶„ì„

{analysis_sections}

---

## STEP 3: ì„±ëŠ¥ ì´ìŠˆ ë¶„ë¥˜

### Critical (ì‹¬ê°í•œ ì„±ëŠ¥ ì €í•˜)
| ë¼ì¸ | ì´ìŠˆ | í˜„ì¬ ë³µì¡ë„ | ê°œì„  í›„ | ì˜ˆìƒ íš¨ê³¼ |
|------|------|------------|---------|----------|
| L{line_placeholder} | [ì´ìŠˆ] | O(nÂ²) | O(n) | 100ë°° í–¥ìƒ |

**ë¬¸ì œ ì½”ë“œ:**
```{language_lower}
[ëŠë¦° ì½”ë“œ]
```

**ìµœì í™”ëœ ì½”ë“œ:**
```{language_lower}
[ë¹ ë¥¸ ì½”ë“œ]
```

### Major (ê°œì„  í•„ìš”)
| ë¼ì¸ | ì´ìŠˆ | ì„¤ëª… | ê°œì„  ë°©í–¥ |
|------|------|------|----------|
| L{line_placeholder} | [ì´ìŠˆ] | [ì„¤ëª…] | [ë°©í–¥] |

### Minor (ìµœì í™” ê°€ëŠ¥)
| ë¼ì¸ | ì´ìŠˆ | ì œì•ˆ |
|------|------|------|
| L{line_placeholder} | [ì´ìŠˆ] | [ì œì•ˆ] |

---

## STEP 4: ìµœì í™”ëœ ì „ì²´ ì½”ë“œ

ëª¨ë“  ì„±ëŠ¥ ì´ìŠˆë¥¼ ìˆ˜ì •í•œ ì½”ë“œì…ë‹ˆë‹¤.

```{language_lower}
[ìµœì í™”ëœ ì „ì²´ ì½”ë“œ]
```

**ìµœì í™” ìš”ì•½:**
| í•­ëª© | Before | After | ê°œì„ ìœ¨ |
|------|--------|-------|--------|
| ì‹œê°„ ë³µì¡ë„ | O(?) | O(?) | - |
| ê³µê°„ ë³µì¡ë„ | O(?) | O(?) | - |
| ì˜ˆìƒ ì†ë„ | ê¸°ì¤€ | ?ë°° | ?% |

---

## STEP 5: ì„±ëŠ¥ ë¦¬ë·° ìš”ì•½

### ì„±ëŠ¥ ì ìˆ˜
- **ì ìˆ˜**: [X/10]
- **ë³‘ëª© ì‹¬ê°ë„**: [Critical/High/Medium/Low]
- **ì˜ˆìƒ ê°œì„  íš¨ê³¼**: [Në°° í–¥ìƒ]

### ìµœì í™” ìš°ì„ ìˆœìœ„
| ìˆœìœ„ | í•­ëª© | ì˜ˆìƒ íš¨ê³¼ | êµ¬í˜„ ë‚œì´ë„ |
|------|------|----------|-----------|
| 1 | [í•­ëª©] | [íš¨ê³¼] | [ë‚œì´ë„] |
| 2 | [í•­ëª©] | [íš¨ê³¼] | [ë‚œì´ë„] |

### ì¶”ê°€ ìµœì í™” ë°©í–¥
- **ìºì‹±**: [ìºì‹± ê°€ëŠ¥ ì—¬ë¶€ ë° ì „ëµ]
- **ë³‘ë ¬í™”**: [ë³‘ë ¬ ì²˜ë¦¬ ê°€ëŠ¥ì„±]
- **ì¸í”„ë¼**: [ì¸í”„ë¼ ìˆ˜ì¤€ ìµœì í™”]

---

## ê²€í†  ì™„ë£Œ í™•ì¸

âœ… ë³µì¡ë„ ë¶„ì„ ì™„ë£Œ
âœ… ì„±ëŠ¥ ì²´í¬ë¦¬ìŠ¤íŠ¸ ëª¨ë“  í•­ëª© ë¶„ì„ ì™„ë£Œ
âœ… ìµœì í™”ëœ ì½”ë“œ ì œì‹œ ì™„ë£Œ
âœ… ê°œì„  íš¨ê³¼ ì •ëŸ‰í™” ì™„ë£Œ
"""


# ============================================================================
# ë¦¬íŒ©í† ë§ ë¦¬ë·° V2.0
# ============================================================================

REFACTORING_REVIEW_V2_TEMPLATE = """## ì—­í• : ë¦¬íŒ©í† ë§ ì „ë¬¸ê°€

ë‹¹ì‹ ì€ ë§ˆí‹´ íŒŒìš¸ëŸ¬ì˜ ë¦¬íŒ©í† ë§ ê¸°ë²•ì— ì •í†µí•œ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

**ë‚˜ì˜ 3ê°€ì§€ ì›ì¹™:**
1. "ëƒ„ìƒˆë‚˜ëŠ” ì½”ë“œëŠ” ë°˜ë“œì‹œ ë¦¬íŒ©í† ë§í•˜ë¼"
2. "ì‘ì€ ë‹¨ê³„ë¡œ ì•ˆì „í•˜ê²Œ ë³€ê²½í•˜ë¼"
3. "í…ŒìŠ¤íŠ¸ ì—†ì´ ë¦¬íŒ©í† ë§í•˜ì§€ ë§ˆë¼"

**ì „ë¬¸ ë¶„ì•¼**: SOLID ì›ì¹™, ë””ìì¸ íŒ¨í„´, í´ë¦° ì•„í‚¤í…ì²˜, ë ˆê±°ì‹œ ì½”ë“œ ê°œì„ 

---

## ë¶„ì„ ëŒ€ìƒ

**ì–¸ì–´**: {language}
**í”„ë ˆì„ì›Œí¬**: {framework}
**ì½”ë“œ íˆìŠ¤í† ë¦¬**: {code_history}
**ë¦¬íŒ©í† ë§ ëª©ì **: {refactoring_goal}

```{language_lower}
{code}
```

---

## ë¦¬íŒ©í† ë§ ì²´í¬ë¦¬ìŠ¤íŠ¸

âš ï¸ **ì¤‘ìš”**: ì•„ë˜ ì½”ë“œ ìŠ¤ë©œì„ **ë°˜ë“œì‹œ** ëª¨ë‘ ê²€í† í•´ì•¼ í•©ë‹ˆë‹¤.

| ë²ˆí˜¸ | ê²€í†  í•­ëª© | ìƒíƒœ |
|------|----------|------|
{checklist}

---

## STEP 1: ì½”ë“œ ìŠ¤ë©œ íƒì§€ (ì²«ì¸ìƒ)

### ì¦‰ì‹œ ê°ì§€ëœ ì½”ë“œ ìŠ¤ë©œ
1. [ìŠ¤ë©œ 1]
2. [ìŠ¤ë©œ 2]
3. [ìŠ¤ë©œ 3]

### SOLID ì›ì¹™ ìœ„ë°˜ ì—¬ë¶€
- **SRP (ë‹¨ì¼ ì±…ì„)**: [ì¤€ìˆ˜/ìœ„ë°˜] - [ì„¤ëª…]
- **OCP (ê°œë°©-íì‡„)**: [ì¤€ìˆ˜/ìœ„ë°˜] - [ì„¤ëª…]
- **LSP (ë¦¬ìŠ¤ì½”í”„ ì¹˜í™˜)**: [ì¤€ìˆ˜/ìœ„ë°˜] - [ì„¤ëª…]
- **ISP (ì¸í„°í˜ì´ìŠ¤ ë¶„ë¦¬)**: [ì¤€ìˆ˜/ìœ„ë°˜] - [ì„¤ëª…]
- **DIP (ì˜ì¡´ì„± ì—­ì „)**: [ì¤€ìˆ˜/ìœ„ë°˜] - [ì„¤ëª…]

---

## STEP 2: ë¦¬íŒ©í† ë§ ì²´í¬ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ ë¶„ì„

{analysis_sections}

---

## STEP 3: ì½”ë“œ ìŠ¤ë©œ ë¶„ë¥˜

### Bloaters (ë¹„ëŒ€í•œ ì½”ë“œ)
| ìŠ¤ë©œ ìœ í˜• | ìœ„ì¹˜ | ì‹¬ê°ë„ | ë¦¬íŒ©í† ë§ ê¸°ë²• |
|----------|------|--------|--------------|
| [Long Method] | L{line_placeholder}-{line_placeholder} | [ë†’ìŒ/ì¤‘ê°„/ë‚®ìŒ] | [Extract Method] |

### Object-Orientation Abusers (OOP ë‚¨ìš©)
| ìŠ¤ë©œ ìœ í˜• | ìœ„ì¹˜ | ì„¤ëª… | ê°œì„  ë°©í–¥ |
|----------|------|------|----------|
| [ìŠ¤ë©œ] | L{line_placeholder} | [ì„¤ëª…] | [ë°©í–¥] |

### Change Preventers (ë³€ê²½ ë°©í•´)
| ìŠ¤ë©œ ìœ í˜• | ìœ„ì¹˜ | ì„¤ëª… | ê°œì„  ë°©í–¥ |
|----------|------|------|----------|
| [ìŠ¤ë©œ] | L{line_placeholder} | [ì„¤ëª…] | [ë°©í–¥] |

### Dispensables (ë¶ˆí•„ìš”í•œ ì½”ë“œ)
| ìŠ¤ë©œ ìœ í˜• | ìœ„ì¹˜ | ì„¤ëª… |
|----------|------|------|
| [ìŠ¤ë©œ] | L{line_placeholder} | [ì„¤ëª…] |

---

## STEP 4: ë‹¨ê³„ë³„ ë¦¬íŒ©í† ë§

### Phase 1: [ì²« ë²ˆì§¸ ë¦¬íŒ©í† ë§]
**ì ìš© ê¸°ë²•**: [ë¦¬íŒ©í† ë§ ê¸°ë²•ëª…]

**Before:**
```{language_lower}
[ë³€ê²½ ì „ ì½”ë“œ]
```

**After:**
```{language_lower}
[ë³€ê²½ í›„ ì½”ë“œ]
```

**ì´ìœ **: [ì™œ ì´ ë³€ê²½ì´ í•„ìš”í•œì§€]

### Phase 2: [ë‘ ë²ˆì§¸ ë¦¬íŒ©í† ë§]
**ì ìš© ê¸°ë²•**: [ë¦¬íŒ©í† ë§ ê¸°ë²•ëª…]

**Before:**
```{language_lower}
[ë³€ê²½ ì „ ì½”ë“œ]
```

**After:**
```{language_lower}
[ë³€ê²½ í›„ ì½”ë“œ]
```

**ì´ìœ **: [ì™œ ì´ ë³€ê²½ì´ í•„ìš”í•œì§€]

### ìµœì¢… ë¦¬íŒ©í† ë§ ê²°ê³¼

```{language_lower}
[ì™„ì „íˆ ë¦¬íŒ©í† ë§ëœ ì „ì²´ ì½”ë“œ]
```

---

## STEP 5: ë¦¬íŒ©í† ë§ ë¦¬ë·° ìš”ì•½

### ì½”ë“œ í’ˆì§ˆ ì ìˆ˜
- **Before**: [X/10]
- **After**: [Y/10]
- **ê°œì„ ìœ¨**: [Z%]

### ì ìš©ëœ ë¦¬íŒ©í† ë§ ê¸°ë²•
1. [ê¸°ë²• 1]: [ì ìš© ìœ„ì¹˜]
2. [ê¸°ë²• 2]: [ì ìš© ìœ„ì¹˜]
3. [ê¸°ë²• 3]: [ì ìš© ìœ„ì¹˜]

### ë¦¬íŒ©í† ë§ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ê¸°ì¡´ ë™ì‘ ìœ ì§€ í™•ì¸
- [ ] í…ŒìŠ¤íŠ¸ ì¶”ê°€ í•„ìš” ì—¬ë¶€
- [ ] ë¬¸ì„œ ì—…ë°ì´íŠ¸ í•„ìš” ì—¬ë¶€

### í…ŒìŠ¤íŠ¸ ì½”ë“œ ì œì•ˆ
```{language_lower}
[ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì½”ë“œ]
```

---

## ê²€í†  ì™„ë£Œ í™•ì¸

âœ… ì½”ë“œ ìŠ¤ë©œ íƒì§€ ì™„ë£Œ
âœ… SOLID ì›ì¹™ ë¶„ì„ ì™„ë£Œ
âœ… ë‹¨ê³„ë³„ ë¦¬íŒ©í† ë§ ì œì‹œ ì™„ë£Œ
âœ… í…ŒìŠ¤íŠ¸ ì½”ë“œ ì œì•ˆ ì™„ë£Œ
"""


# ============================================================================
# í”„ë¡¬í”„íŠ¸ ìƒì„± í•¨ìˆ˜
# ============================================================================

def get_code_review_prompt_v2(
    code: str,
    language: str,
    expected_issues: List[str],
    filename: str = "unknown",
    code_purpose: str = "",
    framework: str = "",
    review_depth: str = "ìƒì„¸ ë¦¬ë·°"
) -> str:
    """
    ì¼ë°˜ ì½”ë“œ ë¦¬ë·° í”„ë¡¬í”„íŠ¸ V2.0 ìƒì„±

    í•µì‹¬ ê°œì„ : expected_issuesë¥¼ ë™ì  ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜
    """
    checklist = _build_checklist(expected_issues)
    analysis_sections = _build_analysis_sections(expected_issues)

    return GENERAL_REVIEW_V2_TEMPLATE.format(
        code=code,
        language=language,
        language_lower=language.lower(),
        filename=filename,
        code_purpose=code_purpose or "ëª…ì‹œë˜ì§€ ì•ŠìŒ",
        framework=framework or "ì—†ìŒ",
        review_depth=review_depth,
        checklist=checklist,
        analysis_sections=analysis_sections,
        line_placeholder="XX"
    )


def get_security_review_prompt_v2(
    code: str,
    language: str,
    expected_issues: List[str],
    app_type: str = "ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜",
    data_type: str = "ì‚¬ìš©ì ì…ë ¥"
) -> str:
    """
    ë³´ì•ˆ ì½”ë“œ ë¦¬ë·° í”„ë¡¬í”„íŠ¸ V2.0 ìƒì„±

    í•µì‹¬ ê°œì„ : expected_issuesë¥¼ ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜
    """
    checklist = _build_checklist(expected_issues)
    analysis_sections = _build_analysis_sections(expected_issues)

    return SECURITY_REVIEW_V2_TEMPLATE.format(
        code=code,
        language=language,
        language_lower=language.lower(),
        app_type=app_type,
        data_type=data_type,
        checklist=checklist,
        analysis_sections=analysis_sections,
        line_placeholder="XX"
    )


def get_performance_review_prompt_v2(
    code: str,
    language: str,
    expected_issues: List[str],
    call_frequency: str = "ë†’ìŒ (ì´ˆë‹¹ 1000íšŒ ì´ìƒ)",
    data_scale: str = "ëŒ€ê·œëª¨ (100ë§Œ ê±´ ì´ìƒ)",
    current_issue: str = ""
) -> str:
    """
    ì„±ëŠ¥ ì½”ë“œ ë¦¬ë·° í”„ë¡¬í”„íŠ¸ V2.0 ìƒì„±

    í•µì‹¬ ê°œì„ : expected_issuesë¥¼ ì„±ëŠ¥ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜
    """
    checklist = _build_checklist(expected_issues)
    analysis_sections = _build_analysis_sections(expected_issues)

    return PERFORMANCE_REVIEW_V2_TEMPLATE.format(
        code=code,
        language=language,
        language_lower=language.lower(),
        call_frequency=call_frequency,
        data_scale=data_scale,
        current_issue=current_issue or "íŠ¹ë³„íˆ ë³´ê³ ëœ ì´ìŠˆ ì—†ìŒ",
        checklist=checklist,
        analysis_sections=analysis_sections,
        line_placeholder="XX"
    )


def get_refactoring_prompt_v2(
    code: str,
    language: str,
    expected_issues: List[str],
    framework: str = "",
    code_history: str = "ë ˆê±°ì‹œ ì½”ë“œ",
    refactoring_goal: str = "ê°€ë…ì„± ë° ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ"
) -> str:
    """
    ë¦¬íŒ©í† ë§ ì œì•ˆ í”„ë¡¬í”„íŠ¸ V2.0 ìƒì„±

    í•µì‹¬ ê°œì„ : expected_issuesë¥¼ ë¦¬íŒ©í† ë§ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜
    """
    checklist = _build_checklist(expected_issues)
    analysis_sections = _build_analysis_sections(expected_issues)

    return REFACTORING_REVIEW_V2_TEMPLATE.format(
        code=code,
        language=language,
        language_lower=language.lower(),
        framework=framework or "ì—†ìŒ",
        code_history=code_history,
        refactoring_goal=refactoring_goal,
        checklist=checklist,
        analysis_sections=analysis_sections,
        line_placeholder="XX"
    )
